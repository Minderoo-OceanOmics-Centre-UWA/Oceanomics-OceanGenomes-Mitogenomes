# nf-core/oceangenomesmitogenomes: Output

## Introduction

This page describes the files produced by the nf-core/oceangenomesmitogenomes pipeline. All
paths are reported relative to the pipeline results directory (`--outdir`). Where appropriate we
highlight the way files are surfaced in the final MultiQC report so you can cross-reference
tabular outputs with the interactive dashboard.

## Pipeline overview

The workflow is built with [Nextflow](https://www.nextflow.io/) and generates the following major
results:

- [Samplesheet preparation](#samplesheet-preparation) – optional creation of a harmonised samplesheet.
- [Mitogenome assembly (GetOrganelle)](#mitogenome-assembly-getorganelle) – short-read assemblies and logs.
- [Mitogenome assembly (MitoHiFi)](#mitogenome-assembly-mitohifi) – HiFi assemblies, stats and plots.
- [Mitogenome annotation](#mitogenome-annotation) – EMMA annotations and per-gene FASTA exports.
- [BLAST filtering and LCA calls](#blast-filtering-and-lca) – gene-level hits and lowest common ancestor tables.
- [Species validation and SQL uploads](#species-validation-and-sql-uploads) – QA summaries plus database upload logs.
- [Submission-ready packaging](#submission-ready-packaging) – GenBank-formatted artefacts produced by the QC subworkflow.
- [MultiQC](#multiqc) – consolidated visual and tabular QC report.
- [Pipeline information](#pipeline-information) – run-level metadata and provenance files.

### Samplesheet preparation

<details markdown="1">
<summary>Output files</summary>

- `samplesheet/`
  - `*.csv`: Combined samplesheet generated by the optional `CREATE_SAMPLESHEET` module. Columns include
    `sample`, `fastq_1`, `fastq_2`, and `sequencing_type` so downstream modules can branch on platform.

</details>

The samplesheet helper scans staged FASTQ files, infers read pairing and sequencing technology, and
emits a unified CSV that can be supplied back into the pipeline. The directory is only populated when
`--create_samplesheet` (or equivalent launch helper) is used.

### Mitogenome assembly (GetOrganelle)

<details markdown="1">
<summary>Output files</summary>

- `mitogenomes/<sample>/<assembly_prefix>/`
  - `mtdna/<assembly_prefix>.fasta`: Final GetOrganelle assembly with the FASTA header rewritten to match the
    per-sample prefix.
  - `mtdna/<assembly_prefix>.get_org.log.txt`: GetOrganelle execution log capturing command-line parameters and statistics.
  - `mtdna/*`: Additional files preserved from the GetOrganelle work directory (depth profiles, intermediate contigs, etc.).

</details>

The GetOrganelle process is configured with `-R 10 -w 95 --continue` and the publish directory structure nests
each sample under `mitogenomes/<sample>/<assembly_prefix>/`. These files form the short-read reference for later
annotation and validation steps.

### Mitogenome assembly (MitoHiFi)

<details markdown="1">
<summary>Output files</summary>

- `mitogenomes/<sample>/<assembly_prefix>/mtdna/`
  - `<assembly_prefix>.fasta`: HiFi-derived circularised assembly with header normalised to the prefix.
  - `<assembly_prefix>.gb`: GenBank annotation file emitted by MitoHiFi.
  - `<assembly_prefix>.contigs_stats.tsv`: Per-contig metrics summarised in MultiQC (`MitoHiFi Contig Stats` section).
  - `<assembly_prefix>.hifiasm.log`, `<assembly_prefix>.log`: Tool and wrapper logs (also parsed by MultiQC).
  - `all_potential_contigs.fa`, `shared_genes.tsv`, PNG plots, and subdirectories (`contigs_circularization/`,
    `coverage_mapping/`, `reads_mapping_and_assembly/`, …) capturing all diagnostic artefacts from MitoHiFi.

</details>

The assembly prefix encodes sample metadata and MitoHiFi version so that downstream artefacts retain the provenance
of the HiFi run. The MultiQC report links to the tabular and graphical summaries stored in this directory.

### Mitogenome annotation

<details markdown="1">
<summary>Output files</summary>

- `mitogenomes/<sample>/<assembly_prefix>/`
  - `emma/`: Directory of EMMA results, including:
    - `<prefix>.emma<version>.fa|gff|tbl|svg`: Primary annotation outputs.
    - `cds/*emma<version>.fa`: Gene-specific nucleotide FASTA files (CO1, 12S, 16S are fed into BLAST).
    - `proteins/*emma<version>.fa`: Protein translations per locus.
  - `versions_emma.yml`: Tool provenance for EMMA (not published to the results directory by default).

</details>

Annotation outputs are reused by the BLAST/LCA subworkflow, QC gating, and GenBank packaging stages, so retaining
the full EMMA directory allows for manual inspection or re-annotation if required.

### BLAST filtering and LCA

<details markdown="1">
<summary>Output files</summary>

- `mitogenomes/<sample>/<assembly_prefix>/lca/`
  - `blast.<gene>.<annotation>.filtered.tsv`: BLAST hits passing length and identity thresholds. A timestamp and gene
    identifier are appended to each row.
  - `filtered_summary.<gene>.txt`: Per-gene hit summaries used by MultiQC (`Species Validation` tables).
  - `lca.<gene>.<annotation>.tsv`: Lowest common ancestor assignments derived from filtered BLAST hits.

</details>

Both the BLAST and LCA modules consume cached taxonomy databases (`taxdb` and `taxdump`). The filtered tables serve as
inputs for species validation and the downstream SQL upload modules.

### Species validation and SQL uploads

<details markdown="1">
<summary>Output files</summary>

- `species_validation/`
  - `lca_results.<sample>.tsv`: Summary of the LCA decision for each marker.
  - `lca_combined.<sample>.tsv`, `blast_combined.<sample>.tsv`: Aggregated tables passed to the upload modules and MultiQC.
- `sql_uploaded_data/`
  - `<sample>.mtdna.upload.txt`: Log of assembly statistics pushed to the OceanOmics SQL database.
  - `<sample>.annotation.upload.txt`: Confirmation log from annotation uploads.
  - `<sample>.annotation_stats.csv`: CSV summarising annotation QC metrics (also plotted in MultiQC).
  - `<sample>.lca_blast.upload.txt`: Log from the combined BLAST/LCA upload.
- `qc/`
  - `<sample>.qc_summary.tsv`: Consolidated flag showing species chosen for QC, annotation pass/fail status, and missing genes.

</details>

The `SPECIES_VALIDATION` process checks marker concordance against the nominal species ID stored in SQL. The
`EVALUATE_QC_CONDITIONS` module determines whether the sample can proceed to GenBank packaging, and its decision is
reported in the QC summary table. All upload modules emit human-readable logs so that database connectivity or data
issues can be audited after a run.

### Submission-ready packaging

<details markdown="1">
<summary>Output files</summary>

- `mitogenomes/<sample>/<assembly_prefix>/genbank/`
  - `processed/*.fa|fasta|gff|tbl|cmt`: GenBank-ready sequence, feature table, and comment files produced by `FORMAT_FILES`.
  - `<sample>.bankit_metadata.csv`, `<sample>.bankit_metadata_latlon_cleaned.csv`: Sample metadata exported from SQL via
    `BUILD_SOURCE_MODIFIERS`.
  - `<assembly_prefix>*.src`: Source modifier template files required by table2asn.
  - `genes/` and `proteins/`: Gene-level FASTA collections used for translation checks.
  - `<assembly_prefix>.sqn`, `<assembly_prefix>.val`, `<assembly_prefix>.gbf`: Submission package, validation report,
    and GenBank flat file generated by `GEN_FILES_TABLE2ASN`. Validation logs are also routed into MultiQC.

</details>

These artefacts provide the material required to submit validated mitogenomes to GenBank. If a sample fails the QC
gating step it will not reach this stage, so directory contents reflect which assemblies are submission-ready.

### MultiQC

<details markdown="1">
<summary>Output files</summary>

- `multiqc/`
  - `multiqc_report.html`: Standalone HTML report.
  - `multiqc_data/`: Parsed metrics from GetOrganelle, MitoHiFi, BLAST/LCA, QC evaluation, and the generic nf-core
    summary plugins.
  - `multiqc_plots/`: Static assets corresponding to each section of the report.

</details>

Beyond the standard FastQC aggregation, the pipeline injects several custom tables into MultiQC, including the
`MitoHiFi Contig Stats`, `Species Validation (LCA Summary)`, `EMMA Annotation Stats`, `QC Summary`, and GenBank
`Table2ASN Validation` sections defined in `assets/multiqc_config.yml`. The consolidated software versions YAML is also
added to the report inputs for traceability.

### Pipeline information

<details markdown="1">
<summary>Output files</summary>

- `pipeline_info/`
  - `nf_core_oceangenomesmitogenomes_software_mqc_versions.yml` and related files collecting tool versions from
    every subworkflow.
  - Standard Nextflow reports: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt`,
    `pipeline_dag.*`.
  - `params.json`: Snapshot of all runtime parameters.
  - `samplesheet.valid.csv`: Copy of the validated input samplesheet used for the run (if supplied).
  - `pipeline_report*`: Optional email reports when `--email`/`--email_on_fail` is configured.

</details>

These artefacts record the exact configuration and runtime behaviour of the workflow so that analyses can be audited
or reproduced.
