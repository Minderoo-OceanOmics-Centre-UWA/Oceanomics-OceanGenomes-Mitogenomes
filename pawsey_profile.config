cleanup = false
resume = true

singularity {
    enabled = true
    autoMounts = true
    cacheDir = "$MYSOFTWARE/.nextflow_singularity"
    envWhitelist = 'SINGULARITY_BINDPATH, SINGULARITYENV_LD_LIBRARY_PATH, SINGULARITYENV_LD_PRELOAD'
}

process {
    beforeScript = '''
        module load singularity/4.1.0-nompi
    '''
    cache = 'lenient'
    stageInMode = 'symlink'
    module = 'singularity/4.1.0-nompi'
    executor = 'slurm'
    clusterOptions = {
        def account = '-A pawsey0964'
        def processName = task.process.tokenize(':').last()
        def finalName = task.tag ? "${task.tag}.${processName}" : processName
        def jobName = "--job-name=${finalName.replaceAll('[^a-zA-Z0-9._-]', '_').take(64)}"
        return "${account} ${jobName}"
    }
}

executor {
    queueSize=1000
    $slurm {
        pollInterval = '1 min'
        queueStatInterval = '5 min'
    }
    $local {
        pollInterval = '2 sec'
    }
}

params {
    max_cpus = 36
    max_time = 24.h
}

env {
    PYTHONNOUSERSITE = 1
}